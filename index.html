<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ Valorant E-sport</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sarabun: ['Sarabun', 'sans-serif'],
          },
          colors: {
            primary: '#ef4444',
            dark: '#0f172a'
          }
        }
      }
    }
  </script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: 'Sarabun', sans-serif; }
  </style>
</head>
<body class="bg-dark text-white min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-gradient-to-r from-primary to-red-700 shadow-md">
    <div class="max-w-4xl mx-auto p-6 text-center">
      <h1 class="text-2xl md:text-3xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ Valorant E-sport</h1>
      <p class="text-sm md:text-base text-white/90 mt-2">
        ‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ò‡∏µ‡∏° Valorant (‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ Nattasan)
      </p>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 py-10">
    <div class="max-w-3xl mx-auto bg-slate-900/80 border border-slate-700 rounded-2xl p-6 space-y-6 shadow-xl">

      <!-- ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô -->
      <form id="certForm" class="space-y-5">

        <div>
          <label class="block text-sm mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</label>
          <input id="nameInput" type="text" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2 text-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô Aniwat Bunkhongmak" required>
        </div>

        <div>
          <label class="block text-sm mb-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
          <select id="positionSelect" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2 text-sm" required>
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
            <option>Match Official</option>
            <option>Coach</option>
            <option>Tournament Organizer</option>
            <option>Tournament Director</option>
            <option>Broadcast Team</option>
            <option>Host</option>
            <option>Caster</option>
            <option>Staff</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-1">‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô</label>
          <textarea id="feelingInput" rows="2" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2 text-sm" required></textarea>
        </div>

        <div>
          <label class="block text-sm mb-1">‡πÄ‡∏ï‡πá‡∏° 10 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà</label>
          <input id="scoreInput" type="number" min="0" max="10" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2 text-sm" required>
        </div>

        <div>
          <label class="block text-sm mb-1">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î</label>
          <textarea id="suggestionInput" rows="2" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2 text-sm" required></textarea>
        </div>

        <div class="pt-3">
          <button type="submit" class="w-full bg-primary hover:bg-red-600 rounded-lg py-2.5 font-semibold transition">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</button>
        </div>

      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-center text-xs text-slate-400 py-4 border-t border-slate-800">
    ¬© 2025 Valorant E-sport | ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ Aniwat Bunkhongmak
  </footer>

  <canvas id="certCanvas" width="3508" height="2480" class="hidden"></canvas>

  <script>
    // =============================
    // üî• Firebase Config
    // =============================
    const firebaseConfig = {
      apiKey: "AIzaSyBqhRPTX1xpRS6jnWUDB6M5XfHQkquDA5E",
      authDomain: "valorant-cert-system.firebaseapp.com",
      projectId: "valorant-cert-system",
      storageBucket: "valorant-cert-system.firebasestorage.app",
      messagingSenderId: "268193476623",
      appId: "1:268193476623:web:61b0914dcef4fa6ef4b37a",
      measurementId: "G-Y2QE9SKT2G"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // =============================
    // üß† Local ID Logic
    // =============================
    const certCanvas = document.getElementById("certCanvas");
    const ctx = certCanvas.getContext("2d");
    const certForm = document.getElementById("certForm");

    const nameInput = document.getElementById("nameInput");
    const positionSelect = document.getElementById("positionSelect");
    const feelingInput = document.getElementById("feelingInput");
    const scoreInput = document.getElementById("scoreInput");
    const suggestionInput = document.getElementById("suggestionInput");

    const STORAGE_KEY = "valorant_cert_id";
    let lastId = parseInt(localStorage.getItem(STORAGE_KEY) || "0");

    function nextId() {
      lastId++;
      localStorage.setItem(STORAGE_KEY, lastId);
      return String(lastId).padStart(3, "0");
    }

    // =============================
    // ‚ú® Draw Certificate
    // =============================
    const templateImg = new Image();
    templateImg.src = "template.png"; // ‡πÉ‡∏™‡πà‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏Ç‡∏ô‡∏≤‡∏î A4 29.7x21cm
    let templateLoaded = false;
    templateImg.onload = () => templateLoaded = true;

    function drawCertificate(id, name, position) {
      const w = certCanvas.width, h = certCanvas.height;
      ctx.clearRect(0, 0, w, h);
      ctx.drawImage(templateImg, 0, 0, w, h);

      ctx.textAlign = "center";
      ctx.fillStyle = "#000";
      ctx.font = "bold 100px 'Times New Roman'";
      ctx.fillText(`${name} (${position})`, w / 2, 1340); // ‡∏ä‡∏∑‡πà‡∏≠+‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏•‡∏á 30px)
      ctx.font = "36px Sarabun";
      ctx.textAlign = "right";
      ctx.fillText("ID: " + id, w - 200, 250);
    }

    function generateCertificateImage(id, name, position) {
      drawCertificate(id, name, position);
      return certCanvas.toDataURL("image/png");
    }

    // =============================
    // üíæ Save Feedback to Firebase
    // =============================
    async function saveFeedback(data) {
      try {
        await db.collection("valorant_feedback").add({
          ...data,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      } catch (err) {
        console.error("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
      }
    }

    // =============================
    // üßæ Submit Form
    // =============================
    certForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = nameInput.value.trim();
      const position = positionSelect.value.trim();
      const feeling = feelingInput.value.trim();
      const score = scoreInput.value.trim();
      const suggestion = suggestionInput.value.trim();

      if (!name || !position || !feeling || !score || !suggestion) {
        Swal.fire("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£", "warning");
        return;
      }

      if (!templateLoaded) {
        Swal.fire("‡∏£‡∏π‡∏õ‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà", "error");
        return;
      }

      const id = nextId();
      Swal.fire({ title: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...", allowOutsideClick: false, didOpen: () => Swal.showLoading() });

      setTimeout(async () => {
        const imgUrl = generateCertificateImage(id, name, position);
        await saveFeedback({ id, name, position, feeling, score, suggestion });

        Swal.fire({
          title: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
          html: `<img src="${imgUrl}" class="w-full rounded-lg border mb-3" />
                 <a href="${imgUrl}" download="Certificate_${id}.png"
                    class="bg-primary hover:bg-red-600 text-white px-4 py-2 rounded">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>`,
          showConfirmButton: false,
          width: "720px",
          background: "#0f172a",
          color: "#fff"
        });

        certForm.reset();
      }, 600);
    });
  </script>
</body>
</html>
